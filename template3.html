<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Professional Resume Template</title>
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap');
        
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background: #f0f0f0;
        }

        .resume-container {
            background: white;
            width: 8.5in;
            height: 11in;
            max-height: 11in;
            margin: 20px auto;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            display: flex;
            border-radius: 0;
            overflow: hidden;
        }

        .sidebar {
            width: 40%;
            background: #1a1a1a;
            color: white;
            padding: 0;
            position: relative;
        }

        .sidebar-header {
            padding: 35px 28px;
            clip-path: polygon(0 0, 100% 0, 100% 85%, 0 100%);
            min-height: 180px;
        }

        .main-content {
            width: 60%;
            padding: 35px;
            background: white;
        }

        .profile-photo-section {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 18px;
            overflow: hidden;
            border: 5px solid white;
            cursor: pointer;
            position: relative;
            background: rgba(255,255,255,0.1);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .profile-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center center;
        }

        .photo-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .profile-photo-section:hover .photo-overlay {
            opacity: 1;
        }

        .name-section {
            text-align: center;
            margin-bottom: 8px;
        }

        .name-input {
            background: transparent;
            border: none;
            color: white;
            font-size: 36px;
            font-weight: 900;
            text-align: center;
            width: 100%;
            outline: none;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .title-input {
            background: transparent;
            border: none;
            color: white;
            font-size: 15px;
            text-align: center;
            width: 100%;
            outline: none;
            font-weight: 300;
            letter-spacing: 1px;
        }

        .sidebar-content {
            padding: 25px 28px;
        }

        .edit-field {
            border: 1px dashed transparent;
            padding: 4px;
            border-radius: 4px;
            background: transparent;
            width: 100%;
            outline: none;
            transition: all 0.2s;
        }

        .edit-field:focus {
            border-color: var(--accent-color);
            background: rgba(255, 107, 53, 0.05);
        }

        .section-title {
            position: relative;
            margin-bottom: 14px;
            padding-bottom: 7px;
        }

        .section-title-input {
            font-size: 15px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: transparent;
            border: 1px dashed transparent;
            padding: 4px;
            border-radius: 4px;
            outline: none;
            transition: all 0.2s;
            width: 100%;
        }

        .section-title-input:focus {
            border-color: var(--accent-color);
            background: rgba(255, 107, 53, 0.05);
        }

        .section-title:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
        }

        .section-title-light .section-title-input {
            color: white;
        }

        .section-title-dark .section-title-input {
            color: #1a1a1a;
        }

        .info-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            font-size: 12px;
        }

        .info-icon {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .skill-bar-container {
            margin-bottom: 14px;
        }

        .skill-name {
            font-size: 12px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }

        .progress-bar {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .experience-item {
            margin-bottom: 24px;
            position: relative;
            padding-left: 18px;
        }

        .experience-item:before {
            content: '';
            position: absolute;
            left: 0;
            top: 7px;
            width: 9px;
            height: 9px;
            border-radius: 50%;
        }

        .experience-title {
            font-weight: 700;
            font-size: 15px;
            color: #1a1a1a;
            margin-bottom: 3px;
        }

        .experience-company {
            font-weight: 500;
            font-size: 13px;
            margin-bottom: 6px;
        }

        .experience-date {
            color: #666;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 7px;
        }

        .experience-description {
            font-size: 12px;
            color: #4a4a4a;
            line-height: 1.5;
        }

        .controls-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            width: 250px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        .btn {
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            width: 100%;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .btn-primary {
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
        }

        @media print {
            .controls-panel { display: none; }
            .resume-container { box-shadow: none; margin: 0; }
            .edit-field { border: none; }
            .section-title-input { border: none; }
            .photo-overlay { display: none !important; }
        }

        .clean-view .edit-field {
            border: none !important;
            background: transparent !important;
            pointer-events: none;
        }

        .clean-view .section-title-input {
            border: none !important;
            background: transparent !important;
            pointer-events: none;
        }

        .clean-view .photo-overlay {
            display: none !important;
        }

        .achievement-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
            font-size: 12px;
            color: rgba(255,255,255,0.9);
        }

        .achievement-icon {
            margin-right: 8px;
            margin-top: 2px;
        }

        .color-picker-section {
            margin-bottom: 15px;
            padding: 12px;
            background: #f9fafb;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
        }

        .color-picker-label {
            font-size: 12px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            display: block;
        }

        .color-input-wrapper {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .color-input {
            width: 60px;
            height: 40px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .color-input:hover {
            border-color: #9ca3af;
            transform: scale(1.05);
        }

        .color-hex {
            font-family: monospace;
            font-size: 11px;
            color: #6b7280;
            background: white;
            padding: 8px 10px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            flex: 1;
        }

        .color-presets {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
            margin-top: 8px;
        }

        .color-preset {
            width: 100%;
            height: 30px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .color-preset:hover {
            border-color: #374151;
            transform: scale(1.1);
        }

        /* Image Cropper Modal Styles */
        .cropper-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            align-items: center;
            justify-content: center;
        }

        .cropper-modal.active {
            display: flex;
        }

        .cropper-container-wrapper {
            background: white;
            border-radius: 12px;
            padding: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow: auto;
        }

        .cropper-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .cropper-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
        }

        .cropper-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cropper-close:hover {
            color: #1f2937;
        }

        .cropper-image-container {
            max-height: 400px;
            margin-bottom: 15px;
            background: #f3f4f6;
            border-radius: 8px;
            overflow: hidden;
        }

        .cropper-image-container img {
            max-width: 100%;
            display: block;
        }

        .cropper-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .cropper-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .cropper-btn-zoom-in {
            background: #3b82f6;
            color: white;
        }

        .cropper-btn-zoom-out {
            background: #6b7280;
            color: white;
        }

        .cropper-btn-rotate {
            background: #8b5cf6;
            color: white;
        }

        .cropper-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .cropper-actions {
            display: flex;
            gap: 10px;
        }

        .cropper-btn-cancel {
            flex: 1;
            background: #ef4444;
            color: white;
        }

        .cropper-btn-apply {
            flex: 1;
            background: #10b981;
            color: white;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;

        function ResumeTemplate() {
            const [accentColor, setAccentColor] = useState('#FF6B35');
            const [accentColor2, setAccentColor2] = useState('#F7931E');
            
            const [sectionTitles, setSectionTitles] = useState({
                education: 'Educación',
                skills: 'Habilidades',
                languages: 'Idiomas',
                profile: 'Perfil',
                experience: 'Experiencia Laboral'
            });

            const [resumeData, setResumeData] = useState({
                name: 'Ricardo López',
                title: 'Fotógrafo',
                photo: null,
                
                contact: {
                    phone: '(55) 1234-5678',
                    email: 'hola@ricloeb.com',
                    location: 'Calle Cuba #123, Cualquier Lugar',
                    website: 'www.sitioincreible.com'
                },
                
                summary: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nist ut aliquip ex ea commodo consequat.',
                
                skills: [
                    { name: 'Photoshop', level: 90 },
                    { name: 'Software 1', level: 85 },
                    { name: 'Software 2', level: 75 }
                ],
                
                languages: [
                    { name: 'Idioma 1', level: 'Nativo' },
                    { name: 'Idioma 2', level: 'Avanzado' }
                ],
                
                experience: [
                    {
                        title: 'Fotógrafo Freelance',
                        company: 'Contratos Junior',
                        date: 'Julio 2023 - Actual',
                        description: 'SERVICIOS EN EVENTOS SOCIALES. EDICIÓN DE FOTOGRAFÍAS. COORDINACIÓN CREATIVA DE PROYECTOS. EDICIÓN DE FOTOGRAFÍA. COORDINACIÓN DE EVENTOS DE ALTO ALCANCE.'
                    },
                    {
                        title: 'Fotógrafo Senior',
                        company: 'Agencia Vandiere',
                        date: 'Enero 2021 - Julio 2023',
                        description: 'SERVICIOS EN EVENTOS SOCIALES. EDICIÓN DE FOTOGRAFÍAS. COORDINACIÓN CREATIVA DE PROYECTOS. EDICIÓN DE FOTOGRAFÍA. COORDINACIÓN DE EVENTOS DE ALTO ALCANCE AUXILIAN EN EVENTOS DE ALTO ALCANCE.'
                    },
                    {
                        title: 'Fotógrafo Junior',
                        company: 'Agencia Borcelle',
                        date: 'Julio 2019 - Enero 2021',
                        description: 'FOTOGRAFÍA EN EVENTOS SOCIALES. EDICIÓN DE FOTOGRAFÍAS. COORDINACIÓN CREATIVA DE PROYECTOS. EDICIÓN DE FOTOGRAFÍA. COORDINACIÓN DE EVENTOS DE ALTO ALCANCE AUXILIAR EN EVENTOS DE ALTO ALCANCE.'
                    }
                ],
                
                education: [
                    {
                        degree: 'Universidad La Sierra',
                        field: 'Bachiller en Mayo 2020',
                        details: 'LICENCIADO EN COMUNICACIÓN GRÁFICA. ÉNFASIS EN VISUALES'
                    },
                    {
                        degree: 'Escuela de Fotografía',
                        field: 'Certificado en Diciembre 2020',
                        details: 'GESTIÓN DE PORTAFOLIO Y EDICIÓN. DIRECCIÓN ARTÍSTICA'
                    }
                ]
            });

            const [isCleanView, setIsCleanView] = useState(false);
            const photoInputRef = useRef(null);
            const [showCropper, setShowCropper] = useState(false);
            const [cropperInstance, setCropperInstance] = useState(null);
            const cropperImageRef = useRef(null);
            const [tempImageSrc, setTempImageSrc] = useState(null);

            const colorPresets = [
                '#FF6B35', '#3B82F6', '#10B981', '#8B5CF6', '#EF4444',
                '#F59E0B', '#06B6D4', '#EC4899', '#6366F1', '#14B8A6'
            ];

            const handleSectionTitleChange = (section, value) => {
                setSectionTitles(prev => ({
                    ...prev,
                    [section]: value
                }));
            };

            const handleInputChange = (section, field, value) => {
                if (section) {
                    setResumeData(prev => ({
                        ...prev,
                        [section]: {
                            ...prev[section],
                            [field]: value
                        }
                    }));
                } else {
                    setResumeData(prev => ({
                        ...prev,
                        [field]: value
                    }));
                }
            };

            const handleArrayItemChange = (array, index, field, value) => {
                const newArray = [...resumeData[array]];
                newArray[index][field] = value;
                setResumeData(prev => ({
                    ...prev,
                    [array]: newArray
                }));
            };

            const handlePhotoUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setTempImageSrc(e.target.result);
                        setShowCropper(true);
                    };
                    reader.readAsDataURL(file);
                }
            };

            const initializeCropper = () => {
                if (cropperImageRef.current && tempImageSrc) {
                    if (cropperInstance) {
                        cropperInstance.destroy();
                    }
                    const cropper = new Cropper(cropperImageRef.current, {
                        aspectRatio: 1,
                        viewMode: 2,
                        dragMode: 'move',
                        autoCropArea: 1,
                        restore: false,
                        guides: true,
                        center: true,
                        highlight: false,
                        cropBoxMovable: true,
                        cropBoxResizable: true,
                        toggleDragModeOnDblclick: false,
                    });
                    setCropperInstance(cropper);
                }
            };

            const handleCropperApply = () => {
                if (cropperInstance) {
                    const canvas = cropperInstance.getCroppedCanvas({
                        width: 400,
                        height: 400,
                        imageSmoothingEnabled: true,
                        imageSmoothingQuality: 'high',
                    });
                    
                    canvas.toBlob((blob) => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            setResumeData(prev => ({
                                ...prev,
                                photo: e.target.result
                            }));
                            handleCropperCancel();
                        };
                        reader.readAsDataURL(blob);
                    }, 'image/jpeg', 0.95);
                }
            };

            const handleCropperCancel = () => {
                if (cropperInstance) {
                    cropperInstance.destroy();
                    setCropperInstance(null);
                }
                setShowCropper(false);
                setTempImageSrc(null);
                if (photoInputRef.current) {
                    photoInputRef.current.value = '';
                }
            };

            const handleCropperZoomIn = () => {
                if (cropperInstance) {
                    cropperInstance.zoom(0.1);
                }
            };

            const handleCropperZoomOut = () => {
                if (cropperInstance) {
                    cropperInstance.zoom(-0.1);
                }
            };

            const handleCropperRotate = () => {
                if (cropperInstance) {
                    cropperInstance.rotate(90);
                }
            };

            React.useEffect(() => {
                if (showCropper && tempImageSrc) {
                    setTimeout(() => {
                        initializeCropper();
                    }, 100);
                }
            }, [showCropper, tempImageSrc]);

            const downloadAsImage = async () => {
                setIsCleanView(true);
                setTimeout(async () => {
                    try {
                        const resume = document.querySelector('.resume-container');
                        const canvas = await html2canvas(resume, {
                            scale: 3,
                            useCORS: true,
                            backgroundColor: '#ffffff',
                            logging: false,
                            onclone: (clonedDoc) => {
                                const clonedResume = clonedDoc.querySelector('.resume-container');
                                clonedResume.style.webkitFontSmoothing = 'antialiased';
                                clonedResume.style.mozOsxFontSmoothing = 'grayscale';
                                
                                const inputs = clonedResume.querySelectorAll('input[type="text"], textarea, input[type="range"]');
                                inputs.forEach(input => {
                                    if (input.type === 'range') {
                                        input.style.display = 'none';
                                        return;
                                    }
                                    
                                    const isTextarea = input.tagName.toLowerCase() === 'textarea';
                                    const element = clonedDoc.createElement('div');
                                    element.textContent = input.value;
                                    
                                    const computedStyle = window.getComputedStyle(input);
                                    element.style.cssText = computedStyle.cssText;
                                    element.style.border = 'none';
                                    element.style.background = 'transparent';
                                    element.style.padding = computedStyle.padding;
                                    element.style.margin = computedStyle.margin;
                                    element.style.width = computedStyle.width;
                                    element.style.height = isTextarea ? computedStyle.height : 'auto';
                                    element.style.minHeight = computedStyle.minHeight;
                                    element.style.fontSize = computedStyle.fontSize;
                                    element.style.fontWeight = computedStyle.fontWeight;
                                    element.style.fontFamily = computedStyle.fontFamily;
                                    element.style.color = computedStyle.color;
                                    element.style.lineHeight = computedStyle.lineHeight;
                                    element.style.textAlign = computedStyle.textAlign;
                                    element.style.whiteSpace = isTextarea ? 'pre-wrap' : 'normal';
                                    element.style.wordBreak = 'break-word';
                                    element.style.display = computedStyle.display;
                                    element.style.webkitFontSmoothing = 'antialiased';
                                    element.style.boxSizing = 'border-box';
                                    
                                    input.parentNode.replaceChild(element, input);
                                });
                            }
                        });
                        const link = document.createElement('a');
                        link.download = 'modern-resume.png';
                        link.href = canvas.toDataURL('image/png', 1.0);
                        link.click();
                        setIsCleanView(false);
                    } catch (error) {
                        console.error('Export failed:', error);
                        alert('Export failed. Please try Print to PDF instead.');
                        setIsCleanView(false);
                    }
                }, 300);
            };

            const downloadMultiFormat = async (format) => {
                const formats = {
                    linkedin: { width: 1200, height: 1200, scale: 6, name: 'linkedin-resume' },
                    instagram: { width: 1080, height: 1350, scale: 6, name: 'instagram-resume' },
                    print: { width: 2550, height: 3300, scale: 4, name: 'print-resume-8.5x11' }
                };

                const spec = formats[format];
                if (!spec) return;

                setIsCleanView(true);
                
                setTimeout(async () => {
                    try {
                        const resume = document.querySelector('.resume-container');
                        const resumeRect = resume.getBoundingClientRect();
                        
                        const canvas = await html2canvas(resume, {
                            scale: spec.scale,
                            useCORS: true,
                            allowTaint: true,
                            backgroundColor: '#ffffff',
                            logging: false,
                            width: resumeRect.width,
                            height: resumeRect.height,
                            onclone: (clonedDoc) => {
                                const clonedResume = clonedDoc.querySelector('.resume-container');
                                clonedResume.style.fontSmooth = 'always';
                                clonedResume.style.webkitFontSmoothing = 'antialiased';
                                clonedResume.style.mozOsxFontSmoothing = 'grayscale';
                                clonedResume.style.textRendering = 'optimizeLegibility';
                                
                                const inputs = clonedResume.querySelectorAll('input[type="text"], textarea, input[type="range"]');
                                inputs.forEach(input => {
                                    if (input.type === 'range') {
                                        input.style.display = 'none';
                                        return;
                                    }
                                    
                                    const isTextarea = input.tagName.toLowerCase() === 'textarea';
                                    const element = clonedDoc.createElement('div');
                                    element.textContent = input.value;
                                    
                                    const computedStyle = window.getComputedStyle(input);
                                    element.style.cssText = computedStyle.cssText;
                                    element.style.border = 'none';
                                    element.style.background = 'transparent';
                                    element.style.padding = computedStyle.padding;
                                    element.style.margin = computedStyle.margin;
                                    element.style.width = computedStyle.width;
                                    element.style.height = isTextarea ? computedStyle.height : 'auto';
                                    element.style.minHeight = computedStyle.minHeight;
                                    element.style.fontSize = computedStyle.fontSize;
                                    element.style.fontWeight = computedStyle.fontWeight;
                                    element.style.fontFamily = computedStyle.fontFamily;
                                    element.style.color = computedStyle.color;
                                    element.style.lineHeight = computedStyle.lineHeight;
                                    element.style.textAlign = computedStyle.textAlign;
                                    element.style.whiteSpace = isTextarea ? 'pre-wrap' : 'normal';
                                    element.style.wordBreak = 'break-word';
                                    element.style.display = computedStyle.display;
                                    element.style.webkitFontSmoothing = 'antialiased';
                                    element.style.boxSizing = 'border-box';
                                    
                                    input.parentNode.replaceChild(element, input);
                                });
                            }
                        });

                        const finalCanvas = document.createElement('canvas');
                        finalCanvas.width = spec.width;
                        finalCanvas.height = spec.height;
                        const ctx = finalCanvas.getContext('2d', { alpha: false });
                        
                        ctx.imageSmoothingEnabled = true;
                        ctx.imageSmoothingQuality = 'high';
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(0, 0, spec.width, spec.height);

                        const fitScale = Math.min(spec.width / canvas.width, spec.height / canvas.height);
                        const drawWidth = canvas.width * fitScale;
                        const drawHeight = canvas.height * fitScale;
                        const offsetX = (spec.width - drawWidth) / 2;
                        const offsetY = (spec.height - drawHeight) / 2;

                        ctx.drawImage(canvas, offsetX, offsetY, drawWidth, drawHeight);

                        const link = document.createElement('a');
                        link.download = `${spec.name}-${Date.now()}.png`;
                        link.href = finalCanvas.toDataURL('image/png', 1.0);
                        link.click();
                        
                        setIsCleanView(false);
                    } catch (error) {
                        console.error('Multi-format export failed:', error);
                        alert('Export failed. Please try again.');
                        setIsCleanView(false);
                    }
                }, 300);
            };

            const handlePrint = () => {
                window.print();
            };

            return (
                <>
                    <style>
                        {`
                            :root {
                                --accent-color: ${accentColor};
                                --accent-color-2: ${accentColor2};
                            }
                            .sidebar-header {
                                background: linear-gradient(135deg, ${accentColor} 0%, ${accentColor2} 100%);
                            }
                            .section-title:after {
                                background: ${accentColor};
                            }
                            .info-icon {
                                background: ${accentColor}20;
                                color: ${accentColor};
                            }
                            .progress-fill {
                                background: linear-gradient(90deg, ${accentColor} 0%, ${accentColor2} 100%);
                            }
                            .experience-item:before {
                                background: ${accentColor};
                            }
                            .experience-company {
                                color: ${accentColor};
                            }
                            .achievement-icon {
                                color: ${accentColor};
                            }
                            .btn-primary {
                                background: linear-gradient(135deg, ${accentColor} 0%, ${accentColor2} 100%);
                            }
                        `}
                    </style>

                    <div className="controls-panel">
                        <h3 className="text-lg font-bold mb-4 text-gray-800">Resume Controls</h3>
                        
                        {/* Color Picker */}
                        <div className="color-picker-section">
                            <label className="color-picker-label">
                                <i className="fas fa-palette mr-1"></i>
                                Accent Color
                            </label>
                            <div className="color-input-wrapper">
                                <input 
                                    type="color" 
                                    className="color-input"
                                    value={accentColor}
                                    onChange={(e) => setAccentColor(e.target.value)}
                                />
                                <span className="color-hex">{accentColor}</span>
                            </div>
                            <div className="color-presets">
                                {colorPresets.map(color => (
                                    <div 
                                        key={color}
                                        className="color-preset"
                                        style={{background: color}}
                                        onClick={() => setAccentColor(color)}
                                        title={color}
                                    />
                                ))}
                            </div>
                        </div>

                        <button 
                            className="btn btn-primary" 
                            onClick={() => photoInputRef.current.click()}
                        >
                            <i className="fas fa-camera mr-2"></i>
                            Upload Photo
                        </button>
                        <input 
                            type="file" 
                            ref={photoInputRef}
                            style={{display: 'none'}}
                            accept="image/*"
                            onChange={handlePhotoUpload}
                        />

                        <button className="btn btn-primary" onClick={handlePrint}>
                            <i className="fas fa-print mr-2"></i>
                            Print / Save PDF
                        </button>

                        <button className="btn" style={{background: '#10b981', color: 'white'}} onClick={downloadAsImage}>
                            <i className="fas fa-image mr-2"></i>
                            Download as PNG
                        </button>

                        {/* Multi-Format Export */}
                        <div style={{marginTop: '15px', paddingTop: '15px', borderTop: '1px solid #e5e7eb'}}>
                            <p className="text-xs font-semibold text-gray-700 mb-2">
                                <i className="fas fa-magic mr-1"></i>
                                Multi-Format Export
                            </p>
                            <button 
                                className="btn" 
                                style={{background: '#0077B5', color: 'white', fontSize: '12px', padding: '8px 12px', marginBottom: '6px'}}
                                onClick={() => downloadMultiFormat('linkedin')}
                            >
                                <i className="fab fa-linkedin mr-1"></i>
                                LinkedIn (1200×1200)
                            </button>
                            <button 
                                className="btn" 
                                style={{background: '#E4405F', color: 'white', fontSize: '12px', padding: '8px 12px', marginBottom: '6px'}}
                                onClick={() => downloadMultiFormat('instagram')}
                            >
                                <i className="fab fa-instagram mr-1"></i>
                                Instagram (1080×1350)
                            </button>
                            <button 
                                className="btn" 
                                style={{background: '#7c3aed', color: 'white', fontSize: '12px', padding: '8px 12px', marginBottom: '6px'}}
                                onClick={() => downloadMultiFormat('print')}
                            >
                                <i className="fas fa-print mr-1"></i>
                                Print Quality (8.5×11)
                            </button>
                        </div>

                        <button 
                            className="btn" 
                            style={{background: '#3b82f6', color: 'white'}}
                            onClick={() => setIsCleanView(!isCleanView)}
                        >
                            <i className={`fas ${isCleanView ? 'fa-edit' : 'fa-eye'} mr-2`}></i>
                            {isCleanView ? 'Show Editor' : 'Preview'}
                        </button>

                        <button 
                            className="btn" 
                            style={{background: '#ef4444', color: 'white', marginTop: '20px'}}
                            onClick={() => window.location.href = 'index.html'}
                        >
                            <i className="fas fa-arrow-left mr-2"></i>
                            Back to Templates
                        </button>
                    </div>

                    <div className={`resume-container ${isCleanView ? 'clean-view' : ''}`}>
                        {/* Sidebar */}
                        <div className="sidebar">
                            <div className="sidebar-header">
                                {/* Photo */}
                                <div 
                                    className="profile-photo-section"
                                    onClick={() => !isCleanView && photoInputRef.current.click()}
                                >
                                    {resumeData.photo ? (
                                        <img src={resumeData.photo} alt="Profile" className="profile-photo" />
                                    ) : (
                                        <div style={{width: '100%', height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', flexDirection: 'column'}}>
                                            <i className="fas fa-user text-5xl mb-2 opacity-50"></i>
                                            <span className="text-xs opacity-75">Upload</span>
                                        </div>
                                    )}
                                    <div className="photo-overlay">
                                        <div className="text-center">
                                            <i className="fas fa-camera text-3xl"></i>
                                        </div>
                                    </div>
                                </div>

                                {/* Name */}
                                <div className="name-section">
                                    <input 
                                        type="text"
                                        className="name-input"
                                        value={resumeData.name}
                                        onChange={(e) => handleInputChange(null, 'name', e.target.value)}
                                        disabled={isCleanView}
                                    />
                                    <input 
                                        type="text"
                                        className="title-input"
                                        value={resumeData.title}
                                        onChange={(e) => handleInputChange(null, 'title', e.target.value)}
                                        disabled={isCleanView}
                                    />
                                </div>
                            </div>

                            <div className="sidebar-content">
                                {/* Education */}
                                <div className="section-title section-title-light">
                                    <input 
                                        type="text"
                                        className="section-title-input"
                                        value={sectionTitles.education}
                                        onChange={(e) => handleSectionTitleChange('education', e.target.value)}
                                        disabled={isCleanView}
                                    />
                                </div>
                                {resumeData.education.map((edu, index) => (
                                    <div key={index} style={{marginBottom: '16px'}}>
                                        <input 
                                            type="text"
                                            className="edit-field"
                                            style={{fontWeight: '700', fontSize: '13px', marginBottom: '3px', color: 'white'}}
                                            value={edu.degree}
                                            onChange={(e) => handleArrayItemChange('education', index, 'degree', e.target.value)}
                                            disabled={isCleanView}
                                        />
                                        <input 
                                            type="text"
                                            className="edit-field"
                                            style={{fontSize: '12px', opacity: '0.9', marginBottom: '5px', color: 'white'}}
                                            value={edu.field}
                                            onChange={(e) => handleArrayItemChange('education', index, 'field', e.target.value)}
                                            disabled={isCleanView}
                                        />
                                        <input 
                                            type="text"
                                            className="edit-field"
                                            style={{fontSize: '11px', opacity: '0.8', lineHeight: '1.3', color: 'white'}}
                                            value={edu.details}
                                            onChange={(e) => handleArrayItemChange('education', index, 'details', e.target.value)}
                                            disabled={isCleanView}
                                        />
                                    </div>
                                ))}

                                {/* Skills */}
                                <div className="section-title section-title-light" style={{marginTop: '26px'}}>
                                    <input 
                                        type="text"
                                        className="section-title-input"
                                        value={sectionTitles.skills}
                                        onChange={(e) => handleSectionTitleChange('skills', e.target.value)}
                                        disabled={isCleanView}
                                    />
                                </div>
                                {resumeData.skills.map((skill, index) => (
                                    <div key={index} className="skill-bar-container">
                                        <div className="skill-name">
                                            <input 
                                                type="text"
                                                className="edit-field"
                                                style={{width: 'auto', minWidth: '100px', color: 'white', fontSize: '13px'}}
                                                value={skill.name}
                                                onChange={(e) => handleArrayItemChange('skills', index, 'name', e.target.value)}
                                                disabled={isCleanView}
                                            />
                                            <span>{skill.level}%</span>
                                        </div>
                                        <div className="progress-bar">
                                            <div className="progress-fill" style={{width: `${skill.level}%`}}></div>
                                        </div>
                                        {!isCleanView && (
                                            <input 
                                                type="range"
                                                min="0"
                                                max="100"
                                                value={skill.level}
                                                onChange={(e) => handleArrayItemChange('skills', index, 'level', parseInt(e.target.value))}
                                                style={{width: '100%', marginTop: '4px', cursor: 'pointer'}}
                                            />
                                        )}
                                    </div>
                                ))}

                                {/* Languages */}
                                <div className="section-title section-title-light" style={{marginTop: '26px'}}>
                                    <input 
                                        type="text"
                                        className="section-title-input"
                                        value={sectionTitles.languages}
                                        onChange={(e) => handleSectionTitleChange('languages', e.target.value)}
                                        disabled={isCleanView}
                                    />
                                </div>
                                {resumeData.languages.map((lang, index) => (
                                    <div key={index} style={{marginBottom: '8px', fontSize: '12px', display: 'flex', gap: '10px'}}>
                                        <input 
                                            type="text"
                                            className="edit-field"
                                            style={{fontWeight: '600', width: 'auto', minWidth: '80px', color: 'white'}}
                                            value={lang.name}
                                            onChange={(e) => handleArrayItemChange('languages', index, 'name', e.target.value)}
                                            disabled={isCleanView}
                                        />
                                        <input 
                                            type="text"
                                            className="edit-field"
                                            style={{opacity: '0.8', flex: 1, color: 'white'}}
                                            value={lang.level}
                                            onChange={(e) => handleArrayItemChange('languages', index, 'level', e.target.value)}
                                            disabled={isCleanView}
                                        />
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Main Content */}
                        <div className="main-content">
                            {/* Contact Info */}
                            <div style={{marginBottom: '26px'}}>
                                <div className="info-row">
                                    <div className="info-icon">
                                        <i className="fas fa-phone"></i>
                                    </div>
                                    <input 
                                        type="text"
                                        className="edit-field"
                                        style={{color: '#1a1a1a', fontSize: '12px'}}
                                        value={resumeData.contact.phone}
                                        onChange={(e) => handleInputChange('contact', 'phone', e.target.value)}
                                        disabled={isCleanView}
                                    />
                                </div>
                                <div className="info-row">
                                    <div className="info-icon">
                                        <i className="fas fa-envelope"></i>
                                    </div>
                                    <input 
                                        type="text"
                                        className="edit-field"
                                        style={{color: '#1a1a1a', fontSize: '12px'}}
                                        value={resumeData.contact.email}
                                        onChange={(e) => handleInputChange('contact', 'email', e.target.value)}
                                        disabled={isCleanView}
                                    />
                                </div>
                                <div className="info-row">
                                    <div className="info-icon">
                                        <i className="fas fa-map-marker-alt"></i>
                                    </div>
                                    <input 
                                        type="text"
                                        className="edit-field"
                                        style={{color: '#1a1a1a', fontSize: '12px'}}
                                        value={resumeData.contact.location}
                                        onChange={(e) => handleInputChange('contact', 'location', e.target.value)}
                                        disabled={isCleanView}
                                    />
                                </div>
                                <div className="info-row">
                                    <div className="info-icon">
                                        <i className="fas fa-globe"></i>
                                    </div>
                                    <input 
                                        type="text"
                                        className="edit-field"
                                        style={{color: '#1a1a1a', fontSize: '12px'}}
                                        value={resumeData.contact.website}
                                        onChange={(e) => handleInputChange('contact', 'website', e.target.value)}
                                        disabled={isCleanView}
                                    />
                                </div>
                            </div>

                            {/* Summary */}
                            <div className="section-title section-title-dark">
                                <input 
                                    type="text"
                                    className="section-title-input"
                                    value={sectionTitles.profile}
                                    onChange={(e) => handleSectionTitleChange('profile', e.target.value)}
                                    disabled={isCleanView}
                                />
                            </div>
                            <textarea 
                                className="edit-field"
                                style={{fontSize: '12px', lineHeight: '1.5', minHeight: '75px', color: '#4a4a4a', marginBottom: '26px'}}
                                value={resumeData.summary}
                                onChange={(e) => handleInputChange(null, 'summary', e.target.value)}
                                disabled={isCleanView}
                            />

                            {/* Experience */}
                            <div className="section-title section-title-dark">
                                <input 
                                    type="text"
                                    className="section-title-input"
                                    value={sectionTitles.experience}
                                    onChange={(e) => handleSectionTitleChange('experience', e.target.value)}
                                    disabled={isCleanView}
                                />
                            </div>
                            {resumeData.experience.map((exp, index) => (
                                <div key={index} className="experience-item">
                                    <input 
                                        type="text"
                                        className="edit-field experience-title"
                                        value={exp.title}
                                        onChange={(e) => handleArrayItemChange('experience', index, 'title', e.target.value)}
                                        disabled={isCleanView}
                                    />
                                    <input 
                                        type="text"
                                        className="edit-field experience-company"
                                        value={exp.company}
                                        onChange={(e) => handleArrayItemChange('experience', index, 'company', e.target.value)}
                                        disabled={isCleanView}
                                    />
                                    <input 
                                        type="text"
                                        className="edit-field experience-date"
                                        value={exp.date}
                                        onChange={(e) => handleArrayItemChange('experience', index, 'date', e.target.value)}
                                        disabled={isCleanView}
                                    />
                                    <textarea 
                                        className="edit-field experience-description"
                                        value={exp.description}
                                        onChange={(e) => handleArrayItemChange('experience', index, 'description', e.target.value)}
                                        disabled={isCleanView}
                                        style={{minHeight: '50px'}}
                                    />
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Image Cropper Modal */}
                    <div className={`cropper-modal ${showCropper ? 'active' : ''}`}>
                        <div className="cropper-container-wrapper">
                            <div className="cropper-header">
                                <h3>
                                    <i className="fas fa-crop-alt mr-2"></i>
                                    Crop Your Photo
                                </h3>
                                <button className="cropper-close" onClick={handleCropperCancel}>
                                    <i className="fas fa-times"></i>
                                </button>
                            </div>
                            
                            <div className="cropper-image-container">
                                {tempImageSrc && (
                                    <img 
                                        ref={cropperImageRef}
                                        src={tempImageSrc} 
                                        alt="Crop preview"
                                        style={{maxWidth: '100%'}}
                                    />
                                )}
                            </div>

                            <div className="cropper-controls">
                                <button className="cropper-btn cropper-btn-zoom-in" onClick={handleCropperZoomIn}>
                                    <i className="fas fa-search-plus mr-1"></i>
                                    Zoom In
                                </button>
                                <button className="cropper-btn cropper-btn-zoom-out" onClick={handleCropperZoomOut}>
                                    <i className="fas fa-search-minus mr-1"></i>
                                    Zoom Out
                                </button>
                                <button className="cropper-btn cropper-btn-rotate" onClick={handleCropperRotate}>
                                    <i className="fas fa-redo mr-1"></i>
                                    Rotate
                                </button>
                            </div>

                            <div className="cropper-actions">
                                <button className="cropper-btn cropper-btn-cancel" onClick={handleCropperCancel}>
                                    <i className="fas fa-times mr-1"></i>
                                    Cancel
                                </button>
                                <button className="cropper-btn cropper-btn-apply" onClick={handleCropperApply}>
                                    <i className="fas fa-check mr-1"></i>
                                    Apply & Save
                                </button>
                            </div>
                        </div>
                    </div>
                </>
            );
        }

        ReactDOM.render(<ResumeTemplate />, document.getElementById('root'));
    </script>
</body>
</html>